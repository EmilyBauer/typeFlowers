<html>
	<head>
		<title>typeFlowers</title>
		<link rel="stylesheet" type="text/css" href="style.css">
	</head>

<body>
	<table class = "head" >
		<tr>
			<td><h1 id="heading">typeFlowers</h1></td></tr>
	</table>
	<table><tr>
		<td>
			 <div class="row">
				<form class="col s12">
				  <div class="row">
					<div class="input-field col s12">
					  <textarea id="textarea1" class="materialize-textarea">Once upon a time...</textarea>
					</div>
				  </div> 
				</form>
			  </div>
			<p id="word">Words: <span id= "writtenwords">hate</span></p>	
			<p id="timer">Timer: <label id="minutes">00</label>:<label id="seconds">00</label></p>
			<p id="wpm">Avg Wpm:  <label id="avgWpm">0</label><br>Live Wpm: <label id="liveWpm">0</label></p>

			<button type="button" id="refreshButton" onclick="refresh()"> Refresh</button>
		</td>
		<td valign = "top">
			<canvas id="TheScreen"></canvas>
			<p></p>
			<input type="submit" value="Save Image" >
			
		</td>
	</table>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> 
	<script>

		
		var iLastTime = 0;
		var iTime = 0;
		var iTotal = 0;
		var iKeys = 0;
		var count = 0;
		var prevCount = 0;
		var thenTime = 0;
		var wordCurrency = 0;
		var minutesLabel = document.getElementById("minutes");
		var secondsLabel = document.getElementById("seconds");
		var totalSeconds = 0;
		setInterval(setTime, 1000);
		
		
		$('#textarea1').on('keyup',function(){
			count = $('#textarea1').val().trim().split(/\s/).length;
			$('#writtenwords').text(count);

		}); 


		$(function() {
			$("#textarea1").keyup(checkSpeed);
		});

		function refresh(){
			iLastTime = 0;
			iTime = 0;
			iTotal = 0;
			iKeys = 0;
			count = 0;
			prevCount = 0;
			thenTime = 0;
			wordCurrency = 0;
			totalSeconds = 0;
			document.getElementById("textarea1").innerText="";
			console.log("test");
		}


		function checkSpeed() {
			iTime = new Date().getTime();
			count = $('#textarea1').val().trim().split(/\s/).length;

			if (iLastTime != 0) {
					iTotal += iTime - iLastTime;
					$('#avgWpm').html(Math.round(count / iTotal * 60000, 2));
			}
			if (count!=prevCount){

				$('#liveWpm').html(Math.round((count-prevCount) / (iTime - thenTime) * 60000, 2));
				if (count!=prevCount){
					wordCurrency++;
				}
				prevCount = count;
				thenTime = iTime;

			}

			iLastTime = iTime;
			
		}
		
		

		function setTime() {
			++totalSeconds;
			secondsLabel.innerHTML = pad(totalSeconds % 60);
			minutesLabel.innerHTML = pad(parseInt(totalSeconds / 60));
		}

		function pad(val) {
			var valString = val + "";
			if (valString.length < 2) {
				return "0" + valString;
			} else {
				return valString;
			}
		}
		

			
	</script>
</body>
	
</html>
